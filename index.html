<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Enjoin ORM by mightydes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Enjoin ORM</h1>
      <h2 class="project-tagline">Multi dialect ORM for PHP inspired by Sequelize.JS</h2>
      <a href="https://github.com/mightydes/enjoin" class="btn">View on GitHub</a>
      <a href="https://github.com/mightydes/enjoin/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/mightydes/enjoin/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="enjoin-orm" class="anchor" href="#enjoin-orm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Enjoin ORM</h1>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>

<p>Enjoin is another PHP ORM (Object Relational Mapping) designed for <a href="http://laravel.com/">Laravel 4</a> framework
and inspired by <a href="http://sequelizejs.com/">Sequelize.js</a> ORM.
Enjoin uses active-record pattern.</p>

<p>Laravel has built in ORM, called <a href="http://laravel.com/docs/4.2/eloquent">Eloquent</a>.
Unfortunately, there are some major disadvantages in Eloquent:</p>

<ul>
<li>Unable to construct associations via <code>join</code> clause
(see <a href="http://stackoverflow.com/questions/11099570/unable-to-get-eloquent-to-automatically-create-joins">Unable to Get Eloquent to Automatically Create Joins</a>).</li>
<li>Unable to built in validation for model.</li>
<li>Unable to order by eager loaded records. </li>
</ul>

<p>Enjoin relies on Laravel components, such as <code>Database</code> and <code>Cache</code>.</p>

<h2>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Documentation</h2>

<ul>
<li><a href="#installation">Installation</a></li>
<li>
<a href="#models">Models</a>

<ul>
<li><a href="#definition">Definition</a></li>
<li><a href="#data-types">Data types</a></li>
<li><a href="#getters-and-setters">Getters and setters</a></li>
<li><a href="#validations">Validations</a></li>
<li>
<a href="#data-retrieval--finders">Data retrieval / Finders</a>

<ul>
<li><a href="#find">find</a></li>
<li><a href="#findorcreate">findOrCreate</a></li>
<li><a href="#findandcountall">findAndCountAll</a></li>
<li><a href="#findall">findAll</a></li>
<li><a href="#complex-filtering--or-queries">Complex filtering / OR queries</a></li>
<li><a href="#manipulating-the-dataset-with-limit-offset-order-and-group">Manipulating the dataset with limit, offset, order and group</a></li>
<li><a href="#raw-queries">Raw queries</a></li>
<li><a href="#count"><em>TODO count</em></a></li>
<li><a href="#max"><em>TODO max</em></a></li>
<li><a href="#min"><em>TODO min</em></a></li>
<li><a href="#sum"><em>TODO sum</em></a></li>
</ul>
</li>
<li><a href="#eager-loading">Eager loading</a></li>
<li><a href="#ordering-eager-loaded-associations">Ordering Eager Loaded Associations</a></li>
<li><a href="#nested-eager-loading">Nested eager loading</a></li>
</ul>
</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<h3>
<a id="warning" class="anchor" href="#warning" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Warning</h3>

<p>Do not use this package in production because it still in heavy development phase.  </p>

<h3>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h3>

<ul>
<li>PHP 5.4+</li>
<li>Laravel 5.0+</li>
</ul>

<h3>
<a id="via-composer" class="anchor" href="#via-composer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Via composer</h3>

<p>Add <code>mightydes\enjoin</code> as a requirement to composer.json:</p>

<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>require<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>mightydes/enjoin<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>dev-master@dev<span class="pl-pds">"</span></span>
    }
}</pre></div>

<p>By default, all models files should be in <code>Models</code> namespace.
You can change it in <code>app/Providers/ConfigServiceProvider.php</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">register</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        config([</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>enjoin<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>models_namespace<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>App\Models<span class="pl-pds">'</span></span></span>
<span class="pl-s1">            ]</span>
<span class="pl-s1">        ]);</span>
<span class="pl-s1">    }</span></pre></div>

<p>Update your packages with <code>composer update</code> or install with <code>composer install</code>.</p>

<p>Once Composer has installed or updated your packages you need to register Enjoin with Laravel itself.
Open up <code>app/config/app.php</code> and find the providers key towards the bottom and add:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-s"><span class="pl-pds">'</span>Enjoin\EnjoinServiceProvider<span class="pl-pds">'</span></span></span></pre></div>

<p>Then add Enjoin Facade for easier access:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-s"><span class="pl-pds">'</span>Enjoin<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Enjoin\EnjoinFacade<span class="pl-pds">'</span></span></span></pre></div>

<p>Now you can access Enjoin in global namespace or in other namespace by adding:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Enjoin</span>;</span></pre></div>

<h2>
<a id="models" class="anchor" href="#models" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Models</h2>

<h3>
<a id="definition" class="anchor" href="#definition" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Definition</h3>

<p>First of all, create <code>BaseModel.php</code> in <code>app/models</code> directory:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// app/models/BaseModel.php</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Models</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">abstract</span> <span class="pl-k">class</span> <span class="pl-en">BaseModel</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// Connection name from `app/config/database` section.</span></span>
<span class="pl-s1">    <span class="pl-c">// You can use `default` string.</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-smi">$connection</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// Related table name.</span></span>
<span class="pl-s1">    <span class="pl-c">// You may pass this variable, and engine fills it automatically.</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-smi">$table</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-smi">$timestamps</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// Name for `createdAt` field (`created_at` by default).</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-smi">$createdAt</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// Name for `updatedAt` field (`updated_at` by default).</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-smi">$updatedAt</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-smi">$cache</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> array</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getAttributes</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> [];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> array</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getRelations</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> [];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">} <span class="pl-c">// end of class</span></span></pre></div>

<p>Each Enjoin model should be placed in <code>app/models</code> folder and extends <code>BaseModel</code> class.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// app/models/Project.php</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Models</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Enjoin</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Project</span> <span class="pl-k">extends</span> <span class="pl-e">BaseModel</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getAttributes</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>Integer()],</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>String()],</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>Text()]</span>
<span class="pl-s1">         ];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">} <span class="pl-c">// end of class</span></span></pre></div>

<p>You can place model file in sub-folder, in this case you can access model like this:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// app/models/alpha/Users.php</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>alpha.Users<span class="pl-pds">'</span></span>);</span></pre></div>

<h3>
<a id="data-types" class="anchor" href="#data-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data types</h3>

<p>Enjoin currently supports the following data types:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span><span class="pl-k">Integer</span>();   <span class="pl-c">// --&gt; INTEGER</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span><span class="pl-k">Boolean</span>();   <span class="pl-c">// --&gt; TINYINT(1) (1 or null)</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span><span class="pl-k">String</span>();    <span class="pl-c">// --&gt; VARCHAR</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span>Text();      <span class="pl-c">// --&gt; TEXT</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span><span class="pl-k">Float</span>();     <span class="pl-c">// --&gt; FLOAT</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span><span class="pl-c1">Date</span>();      <span class="pl-c">// --&gt;DATETIME</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">.</span>Enum();      <span class="pl-c">// --&gt; ENUM</span></span></pre></div>

<h3>
<a id="getters-and-setters" class="anchor" href="#getters-and-setters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getters and setters</h3>

<p>It is possible to define 'object-property' getters and setters functions on your models,
these can be used both for 'protecting' properties that map to database fields and for defining 'pseudo' properties.</p>

<p>To define getter or setter, add <code>get</code> or <code>set</code> closure to model field:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getAttributes</span>()</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">return</span> [</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>latlong<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>String(),</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>allowNull<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">false</span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>get<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$attr</span>, <span class="pl-smi">$getValue</span>) {</span>
<span class="pl-s1">                    <span class="pl-smi">$latlong</span> <span class="pl-k">=</span> $<span class="pl-smi">getValue</span>(<span class="pl-smi">$attr</span>);</span>
<span class="pl-s1">                    <span class="pl-k">if</span> (<span class="pl-c1">is_string</span>(<span class="pl-smi">$latlong</span>) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">strlen</span>(<span class="pl-smi">$latlong</span>) <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {</span>
<span class="pl-s1">                        <span class="pl-smi">$latlong</span> <span class="pl-k">=</span> <span class="pl-c1">explode</span>(<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>, <span class="pl-smi">$latlong</span>);</span>
<span class="pl-s1">                        <span class="pl-k">if</span> (<span class="pl-c1">count</span>(<span class="pl-smi">$latlong</span>) <span class="pl-k">===</span> <span class="pl-c1">2</span>) {</span>
<span class="pl-s1">                            <span class="pl-k">return</span> <span class="pl-c1">array_map</span>(<span class="pl-s"><span class="pl-pds">'</span>floatval<span class="pl-pds">'</span></span>, <span class="pl-smi">$latlong</span>);</span>
<span class="pl-s1">                        }</span>
<span class="pl-s1">                    }</span>
<span class="pl-s1">                    <span class="pl-k">return</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1">                },</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>set<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$attr</span>, <span class="pl-smi">$getValue</span>) {</span>
<span class="pl-s1">                    <span class="pl-smi">$latlong</span> <span class="pl-k">=</span> $<span class="pl-smi">getValue</span>(<span class="pl-smi">$attr</span>);</span>
<span class="pl-s1">                    <span class="pl-k">if</span> (<span class="pl-c1">is_array</span>(<span class="pl-smi">$latlong</span>)) {</span>
<span class="pl-s1">                        <span class="pl-k">return</span> <span class="pl-c1">implode</span>(<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>, <span class="pl-smi">$latlong</span>);</span>
<span class="pl-s1">                    }</span>
<span class="pl-s1">                    <span class="pl-k">return</span> <span class="pl-smi">$latlong</span>;</span>
<span class="pl-s1">                }</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">}</span></pre></div>

<p>Getter (setter) closure has string <code>$attr</code> parameter (table column name),
and closure <code>$getValue</code> parameter, which returns value for given attribute.</p>

<h3>
<a id="validations" class="anchor" href="#validations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validations</h3>

<p>You can specify validation on model field.
Validation will be called when executing the <code>build()</code> or <code>create()</code> functions.
For example:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getAttributes</span>()</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">return</span> [</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>String(),</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>allowNull<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">false</span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>validate<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>between:1,255<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">}</span></pre></div>

<p>On validation fail error would be dropped.
For mor information about available methods and notations
look at corresponded <a href="http://laravel.com/docs/4.2/validation#available-validation-rules">Laravel section</a>.</p>

<h3>
<a id="data-retrieval--finders" class="anchor" href="#data-retrieval--finders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data retrieval / Finders</h3>

<p>Finder methods are designed to get data from the database.
The returned data is an active record object.
Take a look at available model finders:</p>

<h4>
<a id="find" class="anchor" href="#find" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>find</h4>

<p>Search for one specific element in the database:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// search for known ids</span></span>
<span class="pl-s1"><span class="pl-smi">$project</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>find(<span class="pl-c1">123</span>);</span>
<span class="pl-s1"><span class="pl-c">// $project will be an instance of Record and stores the content of the table entry</span></span>
<span class="pl-s1"><span class="pl-c">// with id 123. if such an entry is not defined you will get null</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// search for attributes</span></span>
<span class="pl-s1"><span class="pl-smi">$project</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>find([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>aProject<span class="pl-pds">'</span></span>]</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"><span class="pl-c">// $project will be the first entry of the Projects table with the title 'aProject' || null</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// select some attributes</span></span>
<span class="pl-s1"><span class="pl-smi">$project</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>find([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>aProject<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>attributes<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>]</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"><span class="pl-c">// $project will be the first entry of the Projects table with the title 'aProject' || null</span></span>
<span class="pl-s1"><span class="pl-c">// picked only 'id' and 'name' columns</span></span>
<span class="pl-s1"></span></pre></div>

<p><em>TODO: attribute renaming</em></p>

<h4>
<a id="findorcreate" class="anchor" href="#findorcreate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>findOrCreate</h4>

<p>Search for a specific element or create it if not available.
The method <code>findOrCreate</code> can be used to check if a certain element is already existing in the database.
If that is the case the method will result in a respective instance.
If the element does not yet exist, it will be created.</p>

<p>Let's assume we have an empty database with a <code>User</code> model which has a <code>username</code> and a <code>job</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$user</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>findOrCreate([ <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>job<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Technical Lead JavaScript<span class="pl-pds">'</span></span> ]);</span></pre></div>

<p>The code created a new instance.</p>

<p>So when we already have an instance,</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>create([ <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Alice<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>job<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Ultramarine<span class="pl-pds">'</span></span> ]);</span>
<span class="pl-s1"><span class="pl-smi">$user</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>findOrCreate([ <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Alice<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>job<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Ultramarine<span class="pl-pds">'</span></span> ]);</span></pre></div>

<p>the existing entry will not be changed. See the <code>job</code> of the second user, and the fact that created was false.</p>

<h4>
<a id="findandcountall" class="anchor" href="#findandcountall" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>findAndCountAll</h4>

<p>Search for multiple elements in the database, returns both data and total count.</p>

<p>This is a convenience method that combines <code>findAll()</code> and <code>count()</code> (see below),
this is useful when dealing with queries related to pagination where you want to retrieve data
with a <code>limit</code> and <code>offset</code> but also need to know the total number of records that match the query.</p>

<p>The success handler will always receive an object with two properties:</p>

<ul>
<li>
<code>count</code> - an integer, total number records (matching the where clause).</li>
<li>
<code>rows</code> - an array of objects, the records (matching the where clause) within the limit/offset range.</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$r</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAndCountAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ <span class="pl-s"><span class="pl-pds">'</span>title<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>like<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>%foo%<span class="pl-pds">'</span></span>] ],</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>offset<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">2</span></span>
<span class="pl-s1">]);</span></pre></div>

<p>The options list that you pass to <code>findAndCountAll()</code> is the same as for <code>findAll()</code> (described below).</p>

<h4>
<a id="findall" class="anchor" href="#findall" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>findAll</h4>

<p>Search for multiple elements in the database:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// find multiple entries</span></span>
<span class="pl-s1"><span class="pl-smi">$projects</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll();</span>
<span class="pl-s1"><span class="pl-c">// $projects will be an array of all Project instances</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// search for specific attributes - hash usage</span></span>
<span class="pl-s1"><span class="pl-smi">$projects</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>A Project<span class="pl-pds">'</span></span> ] ]);</span>
<span class="pl-s1"><span class="pl-c">// $projects will be an array of Project instances with the specified name</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// search within a specific range</span></span>
<span class="pl-s1"><span class="pl-smi">$projects</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]] ]);</span>
<span class="pl-s1"><span class="pl-c">// projects will be an array of Projects having the id 1, 2 or 3</span></span>
<span class="pl-s1"><span class="pl-c">// this is actually doing an `IN` query</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$projects</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>gt<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">6</span>,              <span class="pl-c">// id &gt; 6</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>gte<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">6</span>,             <span class="pl-c">// id &gt;= 6</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>lt<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>,             <span class="pl-c">// id &lt; 10</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>lte<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>,            <span class="pl-c">// id &lt;= 10</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>ne<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">20</span>,             <span class="pl-c">// id != 20</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>between<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-c1">6</span>, <span class="pl-c1">10</span>],   <span class="pl-c">// BETWEEN 6 AND 10</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>nbetween<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-c1">6</span>, <span class="pl-c1">10</span>],  <span class="pl-c">// NOT BETWEEN 11 AND 15</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>like<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>%1%<span class="pl-pds">'</span></span>,        <span class="pl-c">// LIKE '%1%'</span></span>
<span class="pl-s1">        ]</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">]);</span></pre></div>

<p><em>TODO: between, nbetween</em></p>

<h4>
<a id="complex-filtering--or-queries" class="anchor" href="#complex-filtering--or-queries" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Complex filtering / OR queries</h4>

<p>It is possible to do complex where queries with multiple levels of nested <code>AND</code> and <code>OR</code> conditions.
In order to do that you can use <code>Enjoin::sqlOr</code> and <code>Enjoin::sqlAnd</code> and pass an arbitrary amount of arguments to it.
Every argument will get transformed into a proper SQL condition and gets joined with the either <code>AND</code> or <code>OR</code>.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>find([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>where<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>sqlAnd(</span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>a project<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">        <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>sqlOr(</span>
<span class="pl-s1">            [<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]],</span>
<span class="pl-s1">            [<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>lt<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>]]</span>
<span class="pl-s1">        )</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">]);</span></pre></div>

<p>This code will generate the following query:</p>

<div class="highlight highlight-source-sql"><pre><span class="pl-k">SELECT</span> <span class="pl-k">*</span>
<span class="pl-k">FROM</span> <span class="pl-s"><span class="pl-pds">`</span>Projects<span class="pl-pds">`</span></span>
<span class="pl-k">WHERE</span> (
  <span class="pl-s"><span class="pl-pds">`</span>Projects<span class="pl-pds">`</span></span>.<span class="pl-s"><span class="pl-pds">`</span>name<span class="pl-pds">`</span></span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>a project<span class="pl-pds">'</span></span>
   <span class="pl-k">AND</span> (<span class="pl-s"><span class="pl-pds">`</span>Projects<span class="pl-pds">`</span></span>.<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">IN</span> (<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>) <span class="pl-k">OR</span> <span class="pl-s"><span class="pl-pds">`</span>Projects<span class="pl-pds">`</span></span>.<span class="pl-s"><span class="pl-pds">`</span>id<span class="pl-pds">`</span></span> <span class="pl-k">&lt;</span> <span class="pl-c1">10</span>)
)
<span class="pl-k">LIMIT</span> <span class="pl-c1">1</span>;</pre></div>

<p>Notice, that instead of <code>Enjoin::sqlAnd</code> you can also use a plain array which will be treated as <code>Enjoin::sqlAnd</code>
if it contains objects or hashes or other complex data types.</p>

<h4>
<a id="manipulating-the-dataset-with-limit-offset-order-and-group" class="anchor" href="#manipulating-the-dataset-with-limit-offset-order-and-group" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Manipulating the dataset with limit, offset, order and group</h4>

<p>To get more relevant data, you can use limit, offset, order and grouping:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// limit the results of the query</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span> ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// step over the first 10 elements</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>offset<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span> ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// step over the first 10 elements, and take 2</span></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>offset<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">10</span>, <span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">2</span> ]);</span></pre></div>

<p>The syntax for grouping and ordering are equal, so below it is only explained with a single example for group,
and the rest for order. Everything you see below can also be done for group:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>title DESC<span class="pl-pds">'</span></span> ]);</span>
<span class="pl-s1"><span class="pl-c">// yields ORDER BY title DESC</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Project<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> ]);</span>
<span class="pl-s1"><span class="pl-c">// yields GROUP BY name</span></span></pre></div>

<p>Notice how in the two examples above, the string provided is inserted verbatim into the query,
i.e. column names are not escaped. If you want to escape column names, you should provide an array of arguments,
even though you only want to order / group by a single column:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Foo<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>find([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-c">// will return `name`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>username DESC<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-c">// will return `username DESC` -- i.e. don't do it!</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>DESC<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">        <span class="pl-c">// will return `username` DESC</span></span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">]);</span></pre></div>

<p><em>TODO: aggregate methods</em></p>

<h4>
<a id="raw-queries" class="anchor" href="#raw-queries" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Raw queries</h4>

<p>Supported by Laravel Database component, <a href="http://laravel.com/docs/4.2/database">see</a>.</p>

<h4>
<a id="count" class="anchor" href="#count" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>count</h4>

<p><em>TODO: Count the occurrences of elements in the database</em></p>

<h4>
<a id="max" class="anchor" href="#max" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>max</h4>

<p><em>TODO: Get the greatest value of a specific attribute within a specific table</em></p>

<h4>
<a id="min" class="anchor" href="#min" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>min</h4>

<p><em>TODO: Get the least value of a specific attribute within a specific table</em></p>

<h4>
<a id="sum" class="anchor" href="#sum" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>sum</h4>

<p><em>TODO: Sum the value of specific attributes</em></p>

<h3>
<a id="eager-loading" class="anchor" href="#eager-loading" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Eager loading</h3>

<p>When you are retrieving data from the database there is a fair chance that you also want to get their associations.
This is possible and is called eager loading. The basic idea behind that, is the use of the attribute
<code>include</code> when you are calling <code>find</code> or <code>findAll</code>. Lets assume the following setup:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// app/models/Task.php</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getRelations</span>()</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">return</span> [</span>
<span class="pl-s1">        <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>belongsTo(<span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>))</span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// app/models/User.php</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getRelations</span>()</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">return</span> [</span>
<span class="pl-s1">        <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>hasMany(<span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Task<span class="pl-pds">'</span></span>)),</span>
<span class="pl-s1">        <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>hasMany(<span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Tool<span class="pl-pds">'</span></span>), [<span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Instruments<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">}</span></pre></div>

<p>OK. So, first of all, let's load all tasks with their associated user:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$r</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Task<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>) ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">[{</span></span>
<span class="pl-s1"><span class="pl-c">    "name": "A Task",</span></span>
<span class="pl-s1"><span class="pl-c">    "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">    "createdAt": "2013-03-20T20:31:40.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "updatedAt": "2013-03-20T20:31:40.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "UserId": 1,</span></span>
<span class="pl-s1"><span class="pl-c">    "user": {</span></span>
<span class="pl-s1"><span class="pl-c">        "name": "John Doe",</span></span>
<span class="pl-s1"><span class="pl-c">        "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">        "createdAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">        "updatedAt": "2013-03-20T20:31:45.000Z"</span></span>
<span class="pl-s1"><span class="pl-c">    }</span></span>
<span class="pl-s1"><span class="pl-c">}]</span></span>
<span class="pl-s1"><span class="pl-c">*/</span></span></pre></div>

<p>Notice that the accessor of the associated data is the name of the model in camel-case with lower-cased first character.
Also the accessor is singular as the association is one-to-something.</p>

<p>Next thing: Loading of data with many-to-something associations:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$r</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Task<span class="pl-pds">'</span></span>) ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">[{</span></span>
<span class="pl-s1"><span class="pl-c">    "name": "John Doe",</span></span>
<span class="pl-s1"><span class="pl-c">    "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">    "createdAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "updatedAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "tasks": [{</span></span>
<span class="pl-s1"><span class="pl-c">        "name": "A Task",</span></span>
<span class="pl-s1"><span class="pl-c">        "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">        "createdAt": "2013-03-20T20:31:40.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">        "updatedAt": "2013-03-20T20:31:40.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">        "UserId": 1</span></span>
<span class="pl-s1"><span class="pl-c">    }]</span></span>
<span class="pl-s1"><span class="pl-c">}]</span></span>
<span class="pl-s1"><span class="pl-c">*/</span></span></pre></div>

<p>Notice that the accessor is plural. This is because the association is many-to-something.</p>

<p>If an association is aliased (using the <code>as</code> option), you <strong>must</strong> specify this alias when including the model.
Notice how the user's <code>Tool</code>s are aliased as <code>Instruments</code> above.
In order to get that right you have to specify the model you want to load, as well as the alias:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$r</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>findAll([ <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Tool<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Instruments<span class="pl-pds">'</span></span>] ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">[{</span></span>
<span class="pl-s1"><span class="pl-c">    "name": "John Doe",</span></span>
<span class="pl-s1"><span class="pl-c">    "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">    "createdAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "updatedAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "instruments": [{</span></span>
<span class="pl-s1"><span class="pl-c">        "name": "Toothpick",</span></span>
<span class="pl-s1"><span class="pl-c">        "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">        "createdAt": null,</span></span>
<span class="pl-s1"><span class="pl-c">        "updatedAt": null,</span></span>
<span class="pl-s1"><span class="pl-c">        "UserId": 1</span></span>
<span class="pl-s1"><span class="pl-c">    }]</span></span>
<span class="pl-s1"><span class="pl-c">}]</span></span>
<span class="pl-s1"><span class="pl-c">*/</span></span></pre></div>

<h3>
<a id="ordering-eager-loaded-associations" class="anchor" href="#ordering-eager-loaded-associations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ordering Eager Loaded Associations</h3>

<p>In the case of a one-to-many relationship:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Company<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> ]</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Company<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>), [<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>DESC<span class="pl-pds">'</span></span>] ]</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Company<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ [<span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Div<span class="pl-pds">'</span></span>] ],</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ [<span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Div<span class="pl-pds">'</span></span>], <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> ]</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"><span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Company<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ [<span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Department<span class="pl-pds">'</span></span>)] ],</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>order<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [ <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Division<span class="pl-pds">'</span></span>), <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Department<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> ]</span>
<span class="pl-s1">]);</span></pre></div>

<p><em>TODO: sort by attributes in the <code>through</code> table</em></p>

<h3>
<a id="nested-eager-loading" class="anchor" href="#nested-eager-loading" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Nested eager loading</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$r</span> <span class="pl-k">=</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>findAll([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Tool<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Instruments<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">            [<span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Enjoin</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>Teacher<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>include<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">                <span class="pl-c">/* etc */</span></span>
<span class="pl-s1">            ]]</span>
<span class="pl-s1">        ]]</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">[{</span></span>
<span class="pl-s1"><span class="pl-c">    "name": "John Doe",</span></span>
<span class="pl-s1"><span class="pl-c">    "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">    "createdAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "updatedAt": "2013-03-20T20:31:45.000Z",</span></span>
<span class="pl-s1"><span class="pl-c">    "instruments": [{ // 1:M and N:M association</span></span>
<span class="pl-s1"><span class="pl-c">        "name": "Toothpick",</span></span>
<span class="pl-s1"><span class="pl-c">        "id": 1,</span></span>
<span class="pl-s1"><span class="pl-c">        "createdAt": null,</span></span>
<span class="pl-s1"><span class="pl-c">        "updatedAt": null,</span></span>
<span class="pl-s1"><span class="pl-c">        "UserId": 1,</span></span>
<span class="pl-s1"><span class="pl-c">        "Teacher": { // 1:1 association</span></span>
<span class="pl-s1"><span class="pl-c">            "name": "Jimi Hendrix"</span></span>
<span class="pl-s1"><span class="pl-c">        }</span></span>
<span class="pl-s1"><span class="pl-c">    }]</span></span>
<span class="pl-s1"><span class="pl-c">}]</span></span>
<span class="pl-s1"><span class="pl-c">*/</span></span></pre></div>

<p><strong>Final note</strong>: If you include an object which is not associated, Enjoin will throw an error.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/mightydes/enjoin">Enjoin ORM</a> is maintained by <a href="https://github.com/mightydes">mightydes</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
